{% extends 'base.html' %}

{% block title %}注册 - 校园人脸识别考勤系统{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0"><i class="fas fa-user-plus me-2"></i>用户注册</h4>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('register') }}">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="student_id" class="form-label">学号 <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-id-card"></i></span>
                                <input type="text" class="form-control" id="student_id" name="student_id" required
                                    autofocus>
                            </div>
                            <div class="form-text">请输入您的学号，将作为登录账号使用</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="name" class="form-label">姓名 <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-user"></i></span>
                                <input type="text" class="form-control" id="name" name="name" required>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="email" class="form-label">电子邮箱 <span class="text-danger">*</span></label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                            <input type="email" class="form-control" id="email" name="email" required>
                        </div>
                        <div class="form-text">请输入有效的电子邮箱，用于接收系统通知</div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="password" class="form-label">密码 <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                <input type="password" class="form-control" id="password" name="password" required>
                            </div>
                            <div class="form-text">密码长度至少为6位，包含字母和数字</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="confirm_password" class="form-label">确认密码 <span
                                    class="text-danger">*</span></label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                <input type="password" class="form-control" id="confirm_password"
                                    name="confirm_password" required>
                            </div>
                            <div class="form-text">请再次输入密码进行确认</div>
                        </div>
                    </div>

                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="terms" required>
                        <label class="form-check-label" for="terms">我已阅读并同意 <a href="#" data-bs-toggle="modal"
                                data-bs-target="#termsModal">用户协议</a> 和 <a href="#" data-bs-toggle="modal"
                                data-bs-target="#privacyModal">隐私政策</a></label>
                    </div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary btn-lg">注册账号</button>
                    </div>
                </form>
            </div>
            <div class="card-footer text-center">
                <p class="mb-0">已有账号？ <a href="{{ url_for('login') }}">立即登录</a></p>
            </div>
        </div>
    </div>
</div>

<!-- Terms Modal -->
<div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="termsModalLabel">用户协议</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h5>校园人脸识别考勤系统用户协议</h5>
                <p>欢迎使用校园人脸识别考勤系统。请仔细阅读以下条款，注册即表示您同意接受本协议的所有条款。</p>

                <h6>1. 服务说明</h6>
                <p>校园人脸识别考勤系统（以下简称"本系统"）是一款基于深度学习的人脸识别考勤系统，为用户提供自动化考勤服务。</p>

                <h6>2. 用户注册与账号安全</h6>
                <p>2.1 用户在注册时需要提供真实、准确、完整的个人资料。<br>
                    2.2 用户应妥善保管账号和密码，因账号和密码泄露导致的一切损失由用户自行承担。<br>
                    2.3 用户注册成功后，需要上传本人的人脸数据用于识别。</p>

                <h6>3. 用户行为规范</h6>
                <p>3.1 用户不得利用本系统进行任何违法或不当的活动。<br>
                    3.2 用户不得尝试破解、篡改或干扰本系统的正常运行。<br>
                    3.3 用户不得上传非本人的人脸数据，或尝试冒充他人进行考勤。</p>

                <h6>4. 隐私保护</h6>
                <p>4.1 本系统重视用户隐私保护，收集的个人信息和人脸数据仅用于考勤目的。<br>
                    4.2 未经用户同意，本系统不会向第三方披露用户个人信息。<br>
                    4.3 详细隐私政策请参阅《隐私政策》。</p>

                <h6>5. 免责声明</h6>
                <p>5.1 本系统不保证服务不会中断，对系统的及时性、安全性、准确性也不作保证。<br>
                    5.2 因网络状况、通讯线路、第三方网站或管理部门的要求等任何原因而导致的服务中断或其他缺陷，本系统不承担任何责任。</p>

                <h6>6. 协议修改</h6>
                <p>本系统有权在必要时修改本协议条款，修改后的协议一旦公布即代替原协议。用户可在本系统查阅最新版协议条款。</p>

                <h6>7. 适用法律</h6>
                <p>本协议的订立、执行和解释及争议的解决均应适用中国法律。</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>

<!-- Privacy Modal -->
<div class="modal fade" id="privacyModal" tabindex="-1" aria-labelledby="privacyModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="privacyModalLabel">隐私政策</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h5>校园人脸识别考勤系统隐私政策</h5>
                <p>本隐私政策说明了我们如何收集、使用、存储和保护您的个人信息。请在使用本系统前仔细阅读本政策。</p>

                <h6>1. 信息收集</h6>
                <p>1.1 基本信息：我们收集您的学号、姓名、电子邮箱等基本信息。<br>
                    1.2 人脸数据：我们收集您的人脸图像并提取特征向量用于身份识别。<br>
                    1.3 考勤记录：我们记录您的考勤时间和考勤状态。</p>

                <h6>2. 信息使用</h6>
                <p>2.1 您的个人信息和人脸数据仅用于身份验证和考勤记录目的。<br>
                    2.2 我们不会将您的个人信息用于与考勤无关的其他目的。<br>
                    2.3 未经您的明确许可，我们不会向任何第三方提供您的个人信息。</p>

                <h6>3. 信息存储与保护</h6>
                <p>3.1 您的人脸特征数据以加密形式存储在我们的数据库中。<br>
                    3.2 我们采取适当的技术和组织措施来保护您的个人信息不被未经授权的访问、使用或泄露。<br>
                    3.3 我们定期审查我们的信息收集、存储和处理实践，以防止未经授权的访问和使用。</p>

                <h6>4. 信息保留</h6>
                <p>4.1 我们仅在必要的时间内保留您的个人信息，以实现本政策中所述的目的。<br>
                    4.2 当您不再使用本系统时，您可以要求我们删除您的个人信息和人脸数据。</p>

                <h6>5. 您的权利</h6>
                <p>5.1 您有权访问、更正或删除您的个人信息。<br>
                    5.2 您有权随时撤回您对收集和使用您个人信息的同意。<br>
                    5.3 如需行使上述权利，请联系系统管理员。</p>

                <h6>6. 政策更新</h6>
                <p>我们可能会不时更新本隐私政策。任何重大变更都会通过电子邮件或系统通知的形式通知您。</p>

                <h6>7. 联系我们</h6>
                <p>如果您对本隐私政策有任何疑问或建议，请联系系统管理员。</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // 密码一致性验证
    document.getElementById('confirm_password').addEventListener('input', function () {
        const password = document.getElementById('password').value;
        const confirmPassword = this.value;

        if (password !== confirmPassword) {
            this.setCustomValidity('两次输入的密码不一致');
        } else {
            this.setCustomValidity('');
        }
    });

    // 密码强度验证
    document.getElementById('password').addEventListener('input', function () {
        const password = this.value;
        const hasLetter = /[a-zA-Z]/.test(password);
        const hasNumber = /[0-9]/.test(password);
        const isLongEnough = password.length >= 6;

        if (!hasLetter || !hasNumber || !isLongEnough) {
            this.setCustomValidity('密码必须至少包含6个字符，包括字母和数字');
        } else {
            this.setCustomValidity('');
        }
    });
</script>
{% endblock %}